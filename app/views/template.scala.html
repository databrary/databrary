@(title : String = "The Databrary Project", angular : Option[play.api.libs.json.JsValue] = None)(body : Html)(implicit request : RequestHeader)
@defining(angular.nonEmpty && SiteApi.jsEnabled) { js =>
<!DOCTYPE html>
<html ng-app="databraryModule">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  @defining("Databrary: The Open Data Library for Developmental Science"){ tail =>
  <title @if(js){ng-bind="page.display.title + ' || @tail'"}>@title || @tail</title>
  }
  
  <!-- icons -->
  <link rel="shortcut icon" href="@routes.Assets.at("icons/favicon.png")">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="@routes.Assets.at("icons/apple-touch-icon-114x114.png")">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="@routes.Assets.at("icons/apple-touch-icon-72x72.png")">
  <link rel="apple-touch-icon-precomposed" href="@routes.Assets.at("icons/apple-touch-icon.png")">
  
  <!-- css -->
  <link rel="stylesheet" href="@routes.Assets.at("app.min.css")">
  
  <!-- js -->
  @if(js) {
    <script src="@routes.SiteApi.constantsJs"></script>
    @SiteApi.jsDepends.map { js =>
      <script src="@routes.Assets.at(js)"></script>
    }
        
  <script>
    window.$play = {
      object: @format.raw(angular.get.toString),
      @request match {
        case site : Site => {
          user: @format.raw(site.json.toString),
        }
        case _ => {
        }
      }
    };
  </script>
  }
</head>

<body class="@if(play.api.Play.isDev(play.api.Play.current)){dev}" flow-prevent-drop>
  <section toolbar id="toolbar" class="toolbar cf">
    <div class="wrap">
      <div class="row">
        <div class="title cf col-desktop-11 col-tablet-5 col-mobile-4">
          <h1 class="toolbar-site">
            <a href="@routes.Site.start" title="Databrary: An Open Data Library"></a>
          </h1>
        </div>

        <div class="toolbar-user col-desktop-4 col-tablet-4 col-mobile-2">
          @request match {
            case request : SiteRequest.Auth[_] => {
              <a href="@routes.PartyHtml.profile" class="toolbar-user-link">
                <span class="username">@request.identity.name</span>
                <img src="@display.avatar(request.identity, 16)" class="toolbar-avatar">
              </a>

              @if(request.access.isAdmin) {
                <span class="sep">|</span>

                @if(request.superuser) {
                  @helper.form(routes.LoginHtml.superuserOff) {
                    <button type="submit" class="link toolbar-superuser on">SU</button>
                  }
                } else {
                  @defining(new LoginController.SuperuserForm()(request)) { form =>
                    @widget.tag.form(form) {
                      @defining(helper.FieldConstructor(widget.tag.rawFieldConstructor.f)) { implicit fieldConstructor =>
                        @widget.tag.inputPassword(form.auth(), 'class -> "mini toolbar-static-input password")
                        <button type="submit" class="link toolbar-superuser off">SU</button>
                      }
                    }(request)
                  }
                }
              }

              <span class="sep">|</span>

              @widget.tag.form(LoginController.LogoutForm) {
                <button type="submit" class="link">@Messages("toolbar.logout")</button>
              }(request)
            }

            case _ => {
              <a href="@routes.LoginHtml.view">@Messages("toolbar.login")</a>
            }
          }
        </div>
      </div>
    </div>
  </section>

  <main ng-view id="main" class="main" autoscroll ng-if="!page.display.error">
    @if(js){
      <noscript>
              @body
      </noscript>
    }else{
      @if(angular) {
        <div>
          Our site works best with modern browsers (Firefox, Chrome, Safari &ge;6, IE &ge;10, and others).
          You are viewing the simple version of our site: some functionality may not be available.
        </div>
      }
      @body
    }
  </main>

  @if(js) {
    <errors></errors>
  }

  <footer id="site-footer" class="site-footer">
    <div class="wrap">
      <div class="row">
        <div class="site-footer-links col-desktop-8 col-tablet-5 col-mobile-6">
          <p>Stay informed with <a href="http://databrary.org/contact/newsletter.html">our newsletter</a>!</p>
        </div>

        <div class="site-footer-social col-desktop-7 col-tablet-4 col-mobile-6">
          <p>Find us on <a href="https://www.linkedin.com/company/databrary-project" class="img"><img id="linkedin" src="/public/images/social/16px/linkedin.png" target="_blank"></a>, <a href="https://www.facebook.com/databrary" target="_blank" class="img"><img id="facebook" src="/public/images/social/16px/facebook.png" alt="Facebook"></a>, <a href="https://plus.google.com/u/1/111083162045777800330/posts" target="_blank" class="img"><img id="google-plus" src="/public/images/social/16px/google-plus.png" alt="Google+"></a>, <a href="https://twitter.com/databrary" target="_blank" class="img"><img id="twitter" src="/public/images/social/16px/twitter.png" alt="Twitter"></a>, and <a href="https://github.com/databrary/" target="_blank" class="img"><img id="github" src="/public/images/social/16px/github.png" alt="GitHub"></a>.</p>
        </div>

        <div class="site-footer-legal col">
          <p>This material is based on work supported by the National Science Foundation under Grant No. BCS-1238599 and the Eunice Kennedy Shriver National Institute of Child Health and Human Development under Cooperative Agreement U01-HD-076595. Any opinions, findings, and conclusions or recommendations expressed in this material are those of the author(s) and do not necessarily reflect the views of the National Science Foundation or the Eunice Kennedy Shriver National Institute of Child Health and Human Development.</p>
          <p>[@site.Site.version] <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">Databrary.org documentation</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>.</p>
          <ul class="site-footer-grants">
            <li><a href="http://www.nsf.gov/awardsearch/showAward?AWD_ID=1238599&HistoricalAwards=false"> <img src="//databrary.org/theme/img/grants/nsf.png" class="nsf"> BCS-1238599</a></li>
            <li><a href="http://projectreporter.nih.gov/project_info_description.cfm?aid=8531595&icde=15908155&ddparam=&ddvalue=&ddsub=&cr=1&csb=default&cs=ASC"> <img src="//databrary.org/theme/img/grants/nih.png" class="nih"> U01-HD-076595</a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer>

  @if(js){
    <messages></messages>
    <tooltips></tooltips>

    <div id="loading" class="loading" ng-show="page.display.loading">
      <div class="loading-animation">
        <div class="loading-spinner">
          <div class="loading-mask">
            <div class="loading-circle"></div>
          </div>
        </div>

        <div class="loading-text">[<span>loading</span>]</div>
      </div>
    </div>
        
    <script>
      document.getElementById('loading').style.display = 'block';
    </script>
  }
</body>
</html>
}
