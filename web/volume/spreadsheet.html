<ng-form name="form">
<div class="spreadsheet-dynamic-info" ng-if="::editing && !top" ng-show="key.id === 'slot'">
  <a href="" ng-click="showConsents=false" ng-show="showConsents">
    Hide legend of session release levels
  </a>
  <a href="" ng-click="showConsents=true" ng-hide="showConsents">
    Show legend of session release levels
  </a>
  <ul class="release-legend flat" ng-show="showConsents">
    <li ng-repeat="(i,c) in page.constants.release" ng-if="i>=0">
      <span class="icon release" ng-class="c"></span>
      <span ng-bind="'release.'+c+'.title' | message"></span>: 
      <span ng-bind="'release.'+c+'.description' | message"></span>
    </li>
  </ul>
</div>
<div class="spreadsheet-dynamic-info" ng-if="::editing && !top" ng-show="key.id !== 'slot'">
  You are in <span class="icon list"></span> <em><span ng-bind="key.name"></span> view</em>. 
  Here you can manage the list of labels in this category. 
  Return to the <a href="" ng-click="setKey('slot')">folder view</a> to edit session data.
</div>

<div class="spreadsheet-options">
  <a ng-if="::!editing && !top" ng-href="{{::volume.csvRoute()}}">export data</a>
</div>

<div class="spreadsheet" ng-class="::{'edit': editing, 'view': !editing}">
  <table class="spreadsheet-table" ng-click="click($event)">
    <colgroup ng-repeat="g in groups track by g.category.id">
      <col ng-repeat="metric in g.metrics track by metric.id" ng-class="[g.category.name, metric.name]"/>
    </colgroup>
    <thead>
      <tr class="spreadsheet-head-groups">
        <th class="metric-col" ng-repeat="col in groups track by col.category.id" id="{{::id}}-category_{{::col.category.id}}" colspan="{{col.metrics.length}}" ng-class="::'col'+col.category.id">
          <span class="spreadsheet-tab-name" ng-bind="::col.category.name" tooltip="col.category.description"></span>
          <span class="icon list spreadsheet-tab-options-icon clickable" ng-click="tabOptionsToggle($event)" ng-if="key === col.category && views.length > 1" tooltip="'spreadsheet.switchview' | message"></span>
          <ul class="flat spreadsheet-tab-options" click-elsewhere="tabOptionsToggle($event)" ng-if="key === col.category && tabOptionsClick">
            <li ng-repeat="c in views track by c.id" class="spreadsheet-tab-option clickable" ng-click="setKey(c.id)" ng-if="key !== c">
              <span ng-if="::key.id !== 'slot' && c.id == 'slot'" ng-bind="::'back to '+c.name+' view'" class="default"></span>
              <span ng-if="::key.id !== 'slot' && c.id !== 'slot' || key.id === 'slot'" ng-bind="::c.name+' view'"></span>
            </li>
          </ul>
        </th>
      </tr>
      <tr class="spreadsheet-head-metrics">
        <th class="clickable" ng-repeat="col in cols" id="{{::id}}-metric_{{::$index}}" ng-click="clickMetric(col)" ng-class="colClasses(col)" ng-bind="col.metric.name" tooltip="col.metric.description"></th>
      </tr>
    </thead>
    <tbody class="spreadsheet-tbody" id="{{::id}}">
    </tbody>
    <tfoot>
      <tr ng-if="more">
        <td colspan="{{cols.length}}" class="null" ng-click="unlimit()" ng-bind="::'spreadsheet.unlimit' | message:more"></td>
      </tr>
    </tfoot>
  </table>
</div>

<a ng-if="::!editing && !top" ng-href="{{::page.router.volumeDescription([volume.id])}}">
  <span class="icon download"></span>
  <span class="download" message="download.zip"></span>
</a>
</ng-form>
